<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEMP478 visualizer from Are.na</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Add your audio player styles here */
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Inter', sans-serif;
        }
        .audio-player {
            width: 100%;
            background: rgba(255, 255, 255, 0.8);
            border-top: 1px solid #000000;
            display: flex;
            align-items: center;
            padding: 20px;
            box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        /* Include the rest of your audio player styles here */
        /* ... */
    </style>
</head>
<body autoscroll="autoscroll">
    <div class="audio-player">
        <div class="volume-control">
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">
        </div>
        <div class="metadata" id="metadata">
            <div id="streamName">STREAM: LOADING...</div>
            <div id="sourceWebsite">SOURCE: LOADING...</div>
        </div>
        <div class="progress" id="progress">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <button class="play-button" id="playButton">‚ñ∂</button>
        <button class="file-button" id="fileButton">üéµ</button>
        
        <!-- Station buttons -->
        <button class="station-button" data-src="https://s5.radio.co/s21c5fbf27/listen"><span>EOS Radio</span></button>
        <button class="station-button" data-src="https://c11.radioboss.fm:18270/stream"><span>Internet Public Radio</span></button>
        <button class="station-button" data-src="https://stream.resonance.fm/resonance-extra"><span>ResonanceExtra</span></button>
        <button class="station-button" data-src="https://radio.syg.ma/audio.ogg"><span>RadioSygma</span></button>
        <button class="station-button" data-src=""><span>...</span></button>
        <button class="station-button" data-src=""><span>...</span></button>
        <button class="station-button" data-src=""><span>...</span></button>
        <button class="station-button" data-src=""><span>...</span></button>
    </div>

    <audio id="audio" src="https://s5.radio.co/s21c5fbf27/listen" preload="auto"></audio>

    <script>
        const audio = document.getElementById('audio');
        const playButton = document.getElementById('playButton');
        const fileButton = document.getElementById('fileButton');
        const streamNameElement = document.getElementById('streamName');
        const sourceWebsiteElement = document.getElementById('sourceWebsite');
        const volumeSlider = document.getElementById('volumeSlider');
        const stationButtons = document.querySelectorAll('.station-button');

        // Set initial volume
        audio.volume = volumeSlider.value;

        // Update volume based on slider input
        volumeSlider.addEventListener('input', (e) => {
            audio.volume = e.target.value;
        });

        // Play button functionality
        playButton.addEventListener('click', () => {
            if (audio.paused) {
                audio.play();
                playButton.textContent = '‚ùö‚ùö'; // Change to pause icon
            } else {
                audio.pause();
                playButton.textContent = '‚ñ∂'; // Change to play icon
            }
        });

        // Change audio source when a station button is clicked
        stationButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                const newSource = e.target.getAttribute('data-src'); // Get the source from data attribute
                audio.src = newSource; // Update audio source
                audio.play(); // Play the new source
                playButton.textContent = '‚ùö‚ùö'; // Change to pause icon
                updateMetadata(newSource); // Update metadata display
            });
        });

        // Function to update metadata
        function updateMetadata(source) {
            const selectedStation = Array.from(stationButtons).find(button => button.getAttribute('data-src') === source).textContent;
            streamNameElement.textContent = `STREAM: ${selectedStation}`;
            sourceWebsiteElement.textContent = `SOURCE: ${source}`;
        }

        // Attempt to get metadata from the stream
        audio.addEventListener('loadedmetadata', () => {
            console.log('Metadata loaded');
            updateMetadata(audio.src); // Update metadata when loaded
        });

        // Initialize metadata on page load
        updateMetadata(audio.src);

        // File button functionality to play fields.mp3
        fileButton.addEventListener('click', () => {
            audio.src = 'fields.mp3'; // Set the audio source to fields.mp3
            audio.play(); // Play the audio file
            playButton.textContent = '‚ùö‚ùö'; // Change to pause icon
            streamNameElement.textContent = 'STREAM: fields.mp3'; // Update stream name
            sourceWebsiteElement.textContent = 'SOURCE: fields.mp3'; // Update source website
        });
    </script>

    <div id="blocks-container"></div>
    <div class="navbar">
      <div class="title">SOLIDE INCANTI<br>records</div>
      <div class="links">
        <a href="about.html">ÀÜabout usÀÜ </a>
        <span> &ensp;&ensp;&ensp;release name &rarr;</span><a href="#" id="channel-link">name-channel-of-reference</a>
      </div>
    </div>
    
    <script src="script.js"></script>
    <script>
        const channelSlug = 'strajk'; // Channel slug
        const apiUrl = `https://api.are.na/v2/channels/${channelSlug}/contents?per=10000`; // Fetch 10000 blocks per request
        let totalBlocks = []; // Array to hold all blocks
        const channelLink = document.getElementById('channel-link');
        channelLink.textContent = channelSlug;

        window.addEventListener('load', () => {
            setTimeout(() => {
                window.scrollTo({ top: 0, behavior: 'instant' });
            }, 7000); // Delay the scrolling action by 5 seconds
        });

        async function fetchChannelContents(page = 1) {
            try {
                const response = await fetch(`${apiUrl}&page=${page}`);
                const data = await response.json();
                totalBlocks = totalBlocks.concat(data.contents); // Concatenate new blocks

                // Check if we need to fetch more pages
                if (data.total_pages > page && totalBlocks.length < 3000) {
                    await fetchChannelContents(page + 1); // Fetch next page
                } else {
                    displayBlocks(totalBlocks.slice(0, 3000)); // Display up to 3000 blocks
                }
            } catch (error) {
                console.error('Error fetching channel contents:', error);
            }
        }

        function displayBlocks(blocks) {
            const blocksContainer = document.getElementById('blocks-container');
            blocksContainer.innerHTML = ''; // Clear previous content

            blocks.forEach(block => {
                const blockElement = document.createElement('div');
                blockElement.classList.add('block');

                if (block.class === 'Image') {
                    blockElement.innerHTML = `<img src="${block.image.display.url}" alt="${block.title || 'Image'}">`;
                } else if (block.class === 'Text') {
                    blockElement.innerHTML = `<h3>${block.title || 'Untitled'}</h3><p>${block.content_html}</p>`;
                } else if (block.class === 'Link') {
                    const thumbnailUrl = block.image ? block.image.thumb.url : ''; // Get thumbnail URL
                    blockElement.innerHTML = `
                        <h3>${block.title || 'Untitled'}</h3>
                        <a href="${block.source.url}" target="_blank">
                            <img class="thumbnail" src="${thumbnailUrl}" alt="${block.title || 'Thumbnail'}">
                        </a>`;
                } else if (block.class === 'Media') {
                    blockElement.innerHTML = `<h3>${block.title || 'Untitled'}</h3><iframe src="${block.source.url}" frameborder="0" allowfullscreen></iframe>`;
                }

                blocksContainer.appendChild(blockElement);
            });
        }

        // Fetch channel contents on page load
        fetchChannelContents();
    </script>
</body>
</html>
